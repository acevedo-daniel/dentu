# ü¶∑ Dentu - API Backend

[![Node.js](https://img.shields.io/badge/Node.js-22.x-green.svg)](https://nodejs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.9.2-blue.svg)](https://www.typescriptlang.org/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-17.6-blue.svg)](https://www.postgresql.org/)
[![Redis](https://img.shields.io/badge/Redis-7.4.5-red.svg)](https://redis.io/)
[![Docker](https://img.shields.io/badge/Docker-‚úì-blue.svg)](https://www.docker.com/)
[![Prisma](https://img.shields.io/badge/Prisma-6.15.0-purple.svg)](https://www.prisma.io/)

> **Dentu** es una API backend moderna construida con Node.js, TypeScript, PostgreSQL y Redis, dise√±ada para aplicaciones de gesti√≥n dental con arquitectura de microservicios.

## üìã Tabla de Contenidos

- [üöÄ Caracter√≠sticas](#-caracter√≠sticas)
- [üèóÔ∏è Arquitectura](#Ô∏è-arquitectura)
- [üìÅ Estructura del Proyecto](#-estructura-del-proyecto)
- [‚öôÔ∏è Requisitos Previos](#Ô∏è-requisitos-previos)
- [üõ†Ô∏è Instalaci√≥n](#Ô∏è-instalaci√≥n)
- [üê≥ Docker](#-docker)
- [üîß Desarrollo](#-desarrollo)
- [üìä Base de Datos](#-base-de-datos)
- [üß™ Testing](#-testing)
- [üì¶ Despliegue](#-despliegue)
- [ü§ù Contribuci√≥n](#-contribuci√≥n)
- [üìÑ Licencia](#-licencia)

## üöÄ Caracter√≠sticas

- **üîÑ Hot Reload** - Desarrollo con recarga autom√°tica usando `tsx`
- **üóÑÔ∏è Base de Datos** - PostgreSQL 17.6 con Prisma ORM
- **‚ö° Cache** - Redis para optimizaci√≥n de rendimiento
- **üê≥ Docker** - Contenedores para desarrollo y producci√≥n
- **üìù TypeScript** - Tipado est√°tico completo
- **üîí Seguridad** - JWT, Helmet, CORS configurado
- **üìä Logging** - Pino con formateo bonito
- **üèóÔ∏è Monorepo** - Estructura modular escalable

## üèóÔ∏è Arquitectura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ    ‚îÇ   API Gateway   ‚îÇ    ‚îÇ   Microservices ‚îÇ
‚îÇ   (Next.js)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Express)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Node.js)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ   PostgreSQL    ‚îÇ
                       ‚îÇ   + Redis       ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìÅ Estructura del Proyecto

```
dentu-develop/
‚îú‚îÄ‚îÄ üìÅ packages/
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ api/                          # API Backend Principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ src/                      # C√≥digo fuente
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ index.ts              # Punto de entrada
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ controllers/          # Controladores
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ services/             # L√≥gica de negocio
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ middleware/           # Middlewares
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ routes/               # Rutas de la API
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ utils/                # Utilidades
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ prisma/                   # Base de datos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ schema.prisma         # Esquema de Prisma
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ migrations/           # Migraciones
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Dockerfile                # Docker para API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ package.json              # Dependencias API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ tsconfig.json             # Config TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ web/                          # Frontend (futuro)
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ whatsapp-bot/                 # Bot WhatsApp (futuro)
‚îú‚îÄ‚îÄ üìÅ docker/
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ init/                         # Scripts de inicializaci√≥n
‚îÇ       ‚îî‚îÄ‚îÄ üìÑ 01-init.sql               # Migraci√≥n inicial
‚îú‚îÄ‚îÄ üìÑ .env                              # Variables de entorno
‚îú‚îÄ‚îÄ üìÑ .dockerignore                     # Archivos ignorados por Docker
‚îú‚îÄ‚îÄ üìÑ docker-compose.yml                # Orquestaci√≥n de servicios
‚îú‚îÄ‚îÄ üìÑ package.json                      # Dependencias ra√≠z
‚îú‚îÄ‚îÄ üìÑ tsconfig.json                     # Config TypeScript ra√≠z
‚îî‚îÄ‚îÄ üìÑ README.md                         # Este archivo
```

## ‚öôÔ∏è Requisitos Previos

### **Software Requerido:**

- **Node.js** 18.x o superior
- **npm** 9.x o superior
- **Docker Desktop** 4.x o superior
- **Git** 2.x o superior

### **Requisitos del Sistema:**

- **RAM**: M√≠nimo 8GB (recomendado 16GB)
- **Almacenamiento**: 10GB de espacio libre
- **Sistema Operativo**: Windows 10+, macOS 10.15+, Ubuntu 20.04+

## üõ†Ô∏è Instalaci√≥n

### **1. Clonar el Repositorio**

```bash
git clone https://github.com/acevedo-daniel/dentu.git
cd dentu-develop
```

### **2. Instalar Dependencias**

```bash
npm install
```

### **3. Configurar Variables de Entorno**

Crear archivo `.env` en la ra√≠z del proyecto:

```bash
# Base de datos
DATABASE_URL="postgresql://dentu_user:dentu_password@postgres:5432/dentu_db?schema=public"

# JWT
JWT_SECRET="your-super-secret-jwt-key-here"

# Servidor
PORT=3000
NODE_ENV=development

# Redis
REDIS_URL="redis://redis:6379"

# CORS
CORS_ORIGIN="http://localhost:3000"

# Logging
LOG_LEVEL="info"
```

### **4. Generar Cliente Prisma**

```bash
npx prisma generate --schema=packages/api/prisma/schema.prisma
```

## üê≥ Docker

### **Levantar Servicios Completos**

```bash
# Desarrollo con hot reload
docker-compose up --build

# En segundo plano
docker-compose up -d --build
```

### **Servicios Disponibles**

| Servicio       | Puerto | Descripci√≥n                      |
| -------------- | ------ | -------------------------------- |
| **API**        | 3000   | Backend principal con hot reload |
| **PostgreSQL** | 5432   | Base de datos principal          |
| **Redis**      | 6379   | Cache y sesiones                 |

### **Comandos Docker √ötiles**

```bash
# Ver logs en tiempo real
docker-compose logs -f api-dev

# Ejecutar comandos en el contenedor
docker-compose exec api-dev npm run prisma:generate

# Rebuild de un servicio espec√≠fico
docker-compose build api-dev

# Detener todos los servicios
docker-compose down

# Limpiar vol√∫menes (¬°CUIDADO! Borra datos)
docker-compose down -v
```

## üîß Desarrollo

### **Scripts Disponibles**

```bash
# Desarrollo local (sin Docker)
npm run dev:api

# Build del proyecto
npm run build

# Linting
npm run lint

# Formateo de c√≥digo
npm run format
```

### **Estructura de la API**

```typescript
// packages/api/src/index.ts
import express from 'express';
import dotenv from 'dotenv';

dotenv.config();

const app = express();
const port = process.env.PORT || 3000;

app.get('/', (req, res) => {
  res.send('¬°La API de Dentu est√° viva! üéâ');
});

app.listen(port, () => {
  console.log(`üöÄ Servidor escuchando en http://localhost:${port}`);
});
```

### **Hot Reload con tsx**

El proyecto usa `tsx` para desarrollo con recarga autom√°tica:

- **Compilaci√≥n instant√°nea** de TypeScript
- **Recarga autom√°tica** al cambiar archivos
- **Logs formateados** con pino-pretty

## üìä Base de Datos

### **PostgreSQL 17.6**

- **Motor**: PostgreSQL con Alpine Linux
- **Persistencia**: Vol√∫menes Docker
- **Migraciones**: Autom√°ticas al levantar Docker
- **Backup**: Configurado con vol√∫menes persistentes

### **Prisma ORM**

```prisma
// packages/api/prisma/schema.prisma
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}
```

### **Migraciones**

```bash
# Crear nueva migraci√≥n
npx prisma migrate dev --name nombre_migracion --schema=packages/api/prisma/schema.prisma

# Aplicar migraciones en producci√≥n
npx prisma migrate deploy --schema=packages/api/prisma/schema.prisma

# Reset de base de datos (desarrollo)
npx prisma migrate reset --schema=packages/api/prisma/schema.prisma
```

### **Redis Cache**

- **Versi√≥n**: 7.4.5 Alpine
- **Persistencia**: Vol√∫menes Docker
- **Uso**: Cache, sesiones, colas de trabajo

## üß™ Testing

### **Framework de Testing**

```bash
# Ejecutar tests
npm test

# Tests en modo watch
npm run test:watch

# Coverage
npm run test:coverage
```

### **Configuraci√≥n de Tests**

- **Jest** como framework principal
- **ts-jest** para TypeScript
- **Supertest** para testing de API
- **Coverage** con reportes HTML

## üì¶ Despliegue

### **Entornos Disponibles**

- **Development**: `docker-compose up --build`
- **Staging**: `docker-compose -f docker-compose.staging.yml up -d`
- **Production**: `docker-compose -f docker-compose.prod.yml up -d`

### **Variables de Entorno por Entorno**

```bash
# Development
NODE_ENV=development
DATABASE_URL=postgresql://dentu_user:dentu_password@postgres:5432/dentu_db

# Production
NODE_ENV=production
DATABASE_URL=${DATABASE_URL}
JWT_SECRET=${JWT_SECRET}
```

### **Docker en Producci√≥n**

```bash
# Build de imagen de producci√≥n
docker build -f packages/api/Dockerfile -t dentu-api:latest .

# Ejecutar en producci√≥n
docker run -d -p 3000:3000 --env-file .env.prod dentu-api:latest
```

## ü§ù Contribuci√≥n

### **Flujo de Trabajo**

1. **Fork** del repositorio
2. **Crear** rama para feature (`git checkout -b feature/nueva-funcionalidad`)
3. **Commit** de cambios (`git commit -am 'Agregar nueva funcionalidad'`)
4. **Push** a la rama (`git push origin feature/nueva-funcionalidad`)
5. **Crear** Pull Request

### **Est√°ndares de C√≥digo**

- **ESLint** para linting
- **Prettier** para formateo
- **TypeScript** estricto
- **Conventional Commits** para mensajes

### **Pre-commit Hooks**

```bash
# Configurado con Husky
npm run prepare

# Hooks autom√°ticos:
# - ESLint
# - Prettier
# - TypeScript check
```

## üìÑ Licencia

Este proyecto est√° bajo la Licencia ISC. Ver el archivo [LICENSE](LICENSE) para m√°s detalles.

## üÜò Soporte

### **Problemas Comunes**

#### **Docker no inicia**

```bash
# Verificar que Docker Desktop est√© ejecut√°ndose
docker --version
docker ps
```

#### **Puerto ya en uso**

```bash
# Cambiar puerto en docker-compose.yml
ports:
  - '3001:3000'  # Usar puerto 3001
```

#### **Base de datos no conecta**

```bash
# Verificar variables de entorno
cat .env

# Rebuild de servicios
docker-compose down
docker-compose up --build
```

### **Recursos Adicionales**

- [üìö Documentaci√≥n de Prisma](https://www.prisma.io/docs/)
- [üê≥ Docker Documentation](https://docs.docker.com/)
- [üìñ TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [üîó Express.js Guide](https://expressjs.com/en/guide/routing.html)

### **Contacto**

- **GitHub**: [@acevedo-daniel](https://github.com/acevedo-daniel)
- **Issues**: [Reportar Bug](https://github.com/acevedo-daniel/dentu/issues)
- **Discussions**: [Discutir Ideas](https://github.com/acevedo-daniel/dentu/discussions)

---

**¬°Gracias por usar Dentu! ü¶∑‚ú®**

_Desarrollado con ‚ù§Ô∏è por el equipo de Dentu_
